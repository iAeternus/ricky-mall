# ricky-mall需求文档

## 登录&统一鉴权

* 支持短信验证码、QQ、微信、账号密码登录
* 登录之后做统一鉴权

## 用户

* 注册

    * 用户注册后，后台持久化用户信息

    * 用户身份

        * 普通用户
            * 注册之后用户类型即为普通用户
        * 企业用户
            * 普通用户通过申请企业账号成为企业用户
        * 商家
            * 普通用户申请店铺认证后成为商家
        * 物流方
            * 申请企业用户时可以选择企业类型为物流企业
        * 管理员
            * 需要派发的申请码才能注册为管理员

    * 用户权限

      | 用户身份 | 用户       | 销售     | 商品 | 订单 | 支付 | 物流 | 店铺 |
                                  | -------- | ---------- | -------- | ---- | ---- | :--- | ---- | ---- |
      | 普通用户 | 登录、登出 | 查看优惠 |      |      |      |      |      |
      | 企业用户 |            |          |      |      |      |      |      |
      | 商家方   |            |          |      |      |      |      |      |
      | 物流方   |            |          |      |      |      |      |      |
      | 管理员   |            |          |      |      |      |      |      |

* 用户具有积分，达到一定积分可以升级

    * 积分获取基础计算公式

      ```python
      def f(x):  
          if 0 <= x < 100:
              # 线性映射 0-100 到 20-30  
              return 20 + ceil(x / 100) * 10  
          elif x < 1000:  
              # 线性映射 100-1000 到 120-140  
              return 120 + ceil((x - 100) / 900) * 20  
          elif x < 10000:  
              # 线性映射 1000-10000 到 200-240  
              return 200 + ceil((x - 1000) / 9000) * 40
          else:
              return 300 + ceil(ln(x - 10000))
      ```

    * 用户级别

        * 白银用户
        * 黄金用户
        * 钻石用户

    * 积分的获取

        * 购买商品，根据商品价格计算积分，不同等级不同算法

        * | 用户级别 | 积分计算公式 |
                                                        | -------- | ------------ |
          | 白银用户 | f(x)         |
          | 黄金用户 | f(x) + 10    |
          | 钻石用户 | f(x) + 30    |

## 销售

* 优惠
    1. 满减：可以多个商品共同参与，汇总金额达到某个阈值之后减免XX金额。
    2. 多买优惠（方式1）：可以多个商品共同参与，汇总购买数量达到一定数量得到X折的优惠。
    3. 多买优惠（方式2）：可以多个商品共同参与，汇总购买数量达到一定数量减免最便宜的X件商品。
    4. 限时折扣：直接商品的购买金额被修改到指定值。
    5. 满减促销的金额满足点以优惠后价格为准，比如该商品既有限时折扣又有满减，则使用限时折扣的价格来计算金额满足点。
    6. 优惠券是在之上的规则计算之后得出的金额基础下计算金额满足点。
    7. 每一个商品的满减+多买优惠仅能参与一种。并且相同促销商品在购物车中商品展示的方式是在一组中。
* 销售方式
    * 直接支付
    * 分期付款
* 售价管理
    * 货币类型
    * 汇率
* 购买
    * 计算实付金额

## 商品

* 价格管理
* 信息管理

## 订单

* 订单
* 订单明细

## 支付

* 付款
    * 付款方式
        * 支付宝（默认）
        * 微信
        * 银联

## 物流

* 暂未设计

## 店铺

* 店铺与商品是一对多的关系
* 店铺管理



